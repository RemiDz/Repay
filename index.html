<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dynamic Debt Repayment Schedule</title>
    <style>
        /* Global Styles */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            margin: 0;
            padding: 0;
        }

        /* Container */
        .container {
            max-width: 80%;
            margin: 50px auto;
            padding: 20px;
            box-sizing: border-box; /* Ensure padding is included in the width */
        }

        /* Header */
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
            font-size: 2em;
        }

        /* Input Fields */
        .input-group {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        .input-group label {
            margin-bottom: 5px;
            font-weight: bold;
            display: block;
        }

        .input-container {
            margin: 10px;
            text-align: center;
        }

        .input-group input {
            padding: 10px;
            width: 200px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .input-group input:focus {
            border-color: #007bff;
            outline: none;
            box-shadow: 0 0 8px rgba(0, 123, 255, 0.25);
        }

        input[type="date"]::-webkit-inner-spin-button,
        input[type="date"]::-webkit-clear-button {
            display: none;
        }

        /* Table Styles */
        table {
            width: 100%;
            max-width: 1200px;
            margin: 20px auto;
            border-collapse: collapse;
            background-color: #fff;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            padding: 10px;
            box-sizing: border-box;
        }

        /* Table Headers */
        thead th {
            background-color: #0051a8;
            color: #fff;
            padding: 10px;
            text-align: center;
            border-bottom: 2px solid #006fe6;
            border-right: 1px solid #fff;
        }

        /* Sub-Headers */
        .loan-header {
            background-color: #e9ecef;
            color: #333;
            text-align: center;
            border-bottom: 1px solid #ccc;
            border-right: 1px solid #ccc;
        }

        /* Table Body */
        tbody td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid #f1f1f1;
            border-right: 1px solid #f1f1f1;
        }

        /* Vertical lines between loan columns */
        .separator-left {
            border-left: 2px solid #007BFF;
        }

        .separator-right {
            border-right: 2px solid #007BFF;
        }

        /* Bold Payment Cells */
        .bold {
            font-weight: bold;
        }

        /* Replace zero values with green tick */
        .green-tick {
            color: green;
            font-size: 1.2em;
        }

        /* Alternating Row Colors */
        tbody tr:nth-child(even) {
            background-color: #f9fbfd;
        }

        /* Hover Effect */
        tbody tr:hover {
            background-color: #f1f3f5;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            h1 {
                font-size: 1.5em;
            }

            .container {
                width: 95%;
                margin: 10px auto;
                padding: 10px;
            }

            .input-group {
                flex-direction: column;
                align-items: center;
            }

            .input-container {
                width: 100%;
            }

            .input-group label, .input-group input {
                margin: 5px 0;
                width: 90%;
            }

            /* Adjust Table for Mobile */
            table {
                max-width: 100%;
                margin: 10px auto;
                font-size: 0.8rem;
            }

            thead th, tbody td {
                padding: 5px;
                font-size: 0.75rem;
            }

            /* Optionally Hide Certain Columns for Mobile */
            tbody td:nth-child(4), /* Difference column */
            tbody td:nth-child(6), /* Loan-1 Interest column */
            tbody td:nth-child(9), /* Loan-2 Interest column */
            thead th:nth-child(4),
            thead th:nth-child(6),
            thead th:nth-child(9) {
                display: none; /* Hides these columns on smaller screens */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Dynamic Debt Repayment Schedule</h1>
        <div class="input-group">
            <div class="input-container">
                <label for="startDate">Start Date:</label>
                <input type="date" id="startDate" value="2024-12-01">
            </div>
        
            <div class="input-container">
                <label for="totalIncome">Total Income (£):</label>
                <input type="number" id="totalIncome" value="4900" min="0" step="0.01">
            </div>
        
            <div class="input-container">
                <label for="essentialSpending">Essential Spending (£):</label>
                <input type="number" id="essentialSpending" value="2500" min="0" step="0.01">
            </div>
        
            <div class="input-container">
                <label for="loan1OriginalBalance">Loan 1 Balance (£):</label>
                <input type="number" id="loan1OriginalBalance" value="8450" min="0" step="0.01">
            </div>
        
            <div class="input-container">
                <label for="loan2OriginalBalance">Loan 2 Balance (£):</label>
                <input type="number" id="loan2OriginalBalance" value="12470" min="0" step="0.01">
            </div>
        </div>
    
        <table id="repaymentTable">
            <thead>
                <tr>
                    <th rowspan="2">Payment Date</th>
                    <th rowspan="2">Total Income (£)</th>
                    <th rowspan="2">Essential Spending (£)</th>
                    <th rowspan="2">Difference (£)</th>
                    <th colspan="3" class="separator-left separator-right">Loan-1</th>
                    <th colspan="3" class="separator-left separator-right">Loan-2</th>
                    <th rowspan="2">Total Payment (£)</th>
                    <th rowspan="2">Remaining (£)</th>
                </tr>
                <tr class="loan-header">
                    <th class="separator-left">Payment (£)</th>
                    <th>Interest (£)</th>
                    <th class="separator-right">Balance (£)</th>
                    <th class="separator-left">Payment (£)</th>
                    <th>Interest (£)</th>
                    <th class="separator-right">Balance (£)</th>
                </tr>
            </thead>
            <tbody>
                <!-- Rows will be inserted by JavaScript -->
            </tbody>
        </table>
    </div>

    <script>
        // Initial Debt details
        let loan1InterestRate = 0.01; // 1% monthly
        let loan2InterestRate = 0.005833; // Approximately 0.5833% monthly
        const loan1MinPayment = 417.00;
        const loan2MinPayment = 270.00;

        // Elements
        const startDateInput = document.getElementById('startDate');
        const totalIncomeInput = document.getElementById('totalIncome');
        const essentialSpendingInput = document.getElementById('essentialSpending');
        const loan1OriginalBalanceInput = document.getElementById('loan1OriginalBalance');
        const loan2OriginalBalanceInput = document.getElementById('loan2OriginalBalance');
        const repaymentTableBody = document.querySelector('#repaymentTable tbody');

        // Event Listeners
        startDateInput.addEventListener('change', calculateAndPopulateSchedule);
        totalIncomeInput.addEventListener('input', calculateAndPopulateSchedule);
        essentialSpendingInput.addEventListener('input', calculateAndPopulateSchedule);
        loan1OriginalBalanceInput.addEventListener('input', calculateAndPopulateSchedule);
        loan2OriginalBalanceInput.addEventListener('input', calculateAndPopulateSchedule);

        function calculateAndPopulateSchedule() {
            const startDate = new Date(startDateInput.value);
            const totalIncome = parseFloat(totalIncomeInput.value) || 0;
            const essentialSpending = parseFloat(essentialSpendingInput.value) || 0;
            const loan1OriginalBalance = parseFloat(loan1OriginalBalanceInput.value) || 0;
            const loan2OriginalBalance = parseFloat(loan2OriginalBalanceInput.value) || 0;

            const incomeSpendingDifference = totalIncome - essentialSpending;

            // Update the schedule
            calculateSchedule(startDate, totalIncome, essentialSpending, incomeSpendingDifference, loan1OriginalBalance, loan2OriginalBalance);
            populateTable();
        }

        // Payment schedule array
        let schedule = [];

        function calculateSchedule(startDate, totalIncome, essentialSpending, incomeSpendingDifference, loan1OriginalBalance, loan2OriginalBalance) {
            schedule = []; // Reset schedule

            let loan1 = {
                balance: loan1OriginalBalance,
                interestRate: loan1InterestRate,
                minPayment: loan1MinPayment
            };

            let loan2 = {
                balance: loan2OriginalBalance,
                interestRate: loan2InterestRate,
                minPayment: loan2MinPayment
            };

            let loan1PaidOff = false;
            let loan2PaidOff = false;
            let currentDate = new Date(startDate);
            let monthCounter = 1;

            while (!loan1PaidOff || !loan2PaidOff) {
                let paymentDate = '1-' + currentDate.toLocaleString('default', { month: 'short' }) + '-' + currentDate.getFullYear();

                // Calculate available funds for loan payments
                let availableFunds = totalIncome - essentialSpending;

                // Ensure available funds cover minimum payments
                let totalMinPayments = 0;
                if (!loan1PaidOff) totalMinPayments += loan1.minPayment;
                if (!loan2PaidOff) totalMinPayments += loan2.minPayment;

                // Loan-2 calculations
                let loan2Interest = loan2.balance * loan2.interestRate;
                loan2.payment = loan2PaidOff ? 0.00 : Math.min(loan2.minPayment, loan2.balance + loan2Interest);
                loan2.balance = loan2.balance + loan2Interest - loan2.payment;

                if (loan2.balance <= 0.01) {
                    loan2PaidOff = true;
                    loan2.balance = 0.00;
                }

                availableFunds -= loan2.payment;

                // Loan-1 calculations
                let loan1Interest = loan1.balance * loan1.interestRate;
                let extraPayment = availableFunds - loan1.minPayment;

                loan1.payment = loan1PaidOff ? 0.00 : Math.min(loan1.minPayment + extraPayment, loan1.balance + loan1Interest);
                loan1.balance = loan1.balance + loan1Interest - loan1.payment;

                if (loan1.balance <= 0.01) {
                    loan1PaidOff = true;
                    loan1.balance = 0.00;
                }

                // After Loan-1 is paid off, allocate all available funds to Loan-2
                if (loan1PaidOff && !loan2PaidOff) {
                    let extraFunds = availableFunds - loan1.payment;
                    loan2.payment += extraFunds;
                    loan2.balance = loan2.balance - extraFunds;
                    if (loan2.balance <= 0.01) {
                        loan2PaidOff = true;
                        loan2.balance = 0.00;
                    }
                }

                // Total payment
                let totalPayment = loan1.payment + loan2.payment;
                let remaining = totalIncome - essentialSpending - totalPayment;

                // Add to schedule
                schedule.push({
                    paymentDate: paymentDate,
                    totalIncome: totalIncome.toFixed(0),
                    essentialSpending: essentialSpending.toFixed(0),
                    incomeSpendingDifference: incomeSpendingDifference.toFixed(0),
                    loan1Payment: loan1.payment.toFixed(0),
                    loan1Interest: loan1Interest.toFixed(0),
                    loan1Balance: loan1.balance.toFixed(0),
                    loan2Payment: loan2.payment.toFixed(0),
                    loan2Interest: loan2Interest.toFixed(0),
                    loan2Balance: loan2.balance.toFixed(0),
                    totalPayment: totalPayment.toFixed(0),
                    remaining: remaining.toFixed(0)
                });

                // Move to next month
                currentDate.setMonth(currentDate.getMonth() + 1);
                monthCounter++;

                // Safety check to prevent infinite loop
                if (monthCounter > 360) { // Max 30 years
                    alert('Repayment schedule exceeds 30 years. Please adjust your income or expenses.');
                    break;
                }
            }
        }

        function populateTable() {
            repaymentTableBody.innerHTML = ''; // Clear existing rows

            schedule.forEach(row => {
                const tr = document.createElement('tr');

                // Payment Date
                let td = document.createElement('td');
                td.textContent = row.paymentDate;
                tr.appendChild(td);

                // Total Income
                td = document.createElement('td');
                td.textContent = '£' + row.totalIncome;
                td.style.color = '#28a745';
                tr.appendChild(td);

                // Essential Spending
                td = document.createElement('td');
                td.textContent = '£' + row.essentialSpending;
                td.style.color = '#dc3545';
                tr.appendChild(td);

                // Difference
                td = document.createElement('td');
                td.textContent = '£' + row.incomeSpendingDifference;
                td.style.color = '#007bff';
                tr.appendChild(td);

                // Loan-1 Data
                tr.classList.add('grouped-data');

                // Loan-1 Payment
                td = document.createElement('td');
                if (parseFloat(row.loan1Payment) <= 0.01) {
                    td.innerHTML = '<span class="green-tick">&#10004;</span>';
                } else {
                    td.textContent = '£' + row.loan1Payment;
                    td.classList.add('bold');
                }
                td.classList.add('separator-left');
                tr.appendChild(td);

                // Loan-1 Interest
                td = document.createElement('td');
                if (parseFloat(row.loan1Interest) <= 0.01) {
                    td.innerHTML = '<span class="green-tick">&#10004;</span>';
                } else {
                    td.textContent = '£' + row.loan1Interest;
                }
                tr.appendChild(td);

                // Loan-1 Balance
                td = document.createElement('td');
                if (parseFloat(row.loan1Balance) <= 0.01) {
                    td.innerHTML = '<span class="green-tick">&#10004;</span>';
                } else {
                    td.textContent = '£' + row.loan1Balance;
                }
                td.classList.add('separator-right');
                tr.appendChild(td);

                // Loan-2 Data

                // Loan-2 Payment
                td = document.createElement('td');
                if (parseFloat(row.loan2Payment) <= 0.01) {
                    td.innerHTML = '<span class="green-tick">&#10004;</span>';
                } else {
                    td.textContent = '£' + row.loan2Payment;
                    td.classList.add('bold');
                }
                td.classList.add('separator-left');
                tr.appendChild(td);

                // Loan-2 Interest
                td = document.createElement('td');
                td.textContent = '£' + row.loan2Interest;
                tr.appendChild(td);

                // Loan-2 Balance
                td = document.createElement('td');
                if (parseFloat(row.loan2Balance) <= 0.01) {
                    td.innerHTML = '<span class="green-tick">&#10004;</span>';
                } else {
                    td.textContent = '£' + row.loan2Balance;
                }
                td.classList.add('separator-right');
                tr.appendChild(td);

                // Total Payment
                td = document.createElement('td');
                td.textContent = '£' + row.totalPayment;
                td.style.color = '#17a2b8';
                tr.appendChild(td);

                // Remaining
                td = document.createElement('td');
                td.textContent = '£' + row.remaining;
                td.style.color = '#ffc107';
                tr.appendChild(td);

                repaymentTableBody.appendChild(tr);
            });
        }

        // Initial calculation
        calculateAndPopulateSchedule();
    </script>
</body>
</html>
